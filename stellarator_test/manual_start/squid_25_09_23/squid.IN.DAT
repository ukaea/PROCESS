*************************************************************************
*****                                                               *****
*****                        SQuID_v1                               *****
*****               Jedrzej Walkowiak (28/07/2025)                  *****
*****            Based on Felix Warmer Run (27/05/2015)             *****
*****   Warmer et al. (2016), IEEE Trans. Plasma Sci. 44, 1576      *****
*****                                                               *****
*************************************************************************

*---------------Constraint Equations---------------*

neqns = 2               *number of equalities


*--------------- equaltities
icc = 2                 *Global power balance (consistency equation)
icc = 16                *Net electric power lower limit
p_plant_electric_net_required_mw = 1000         * Required net electric power (MW)

*-------------- inequaltities

* Beta limit
icc = 24                *Upper beta limit
beta_vol_avg_max = 0.04

* Neutron wall load upper limit (itv 14,1,2,3,4,6)
icc = 8  * icc_wallmw 
pflux_fw_neutron_max_mw = 1.5    * Allowable Neutron Wall-Load (MW/M2) (`Constraint Equation 8`)

* Radiation fraction upper limit (itv 28)
icc = 17 * icc_maxradiation

* Divertor heat load upper limit (itv 27)
icc = 18 * icc_divertor
pflux_div_heat_load_max_mw = 10 * Divertor Heat Load Limit (MW/M2)

* Simple Radiation Wall load limit (itv 116, 4,6)
icc = 67 * icc_radiationload
pflux_fw_rad_max = 1.2  * Max Permitted Radiation Wall Load (MW/M^2) (`Constraint Equation 67`)

* toroidalgap > tftort constraint (itv 171 ftoroidalgap)
icc = 82 * icc_toroidalbuild

* Radial build consistency for stellarators (itv 172 f_avspace)
icc = 83 * icc_placeforblanket

* f_alpha_energy_confinement the ratio of particle to energy confinement times (itv 110)
icc = 62 * icc_thermalHe
f_alpha_energy_confinement_min = 4     * tau_He/tau_E

*** QUENCH LIMITS *** 

* TF coil conduit stress upper limit (SCTF) (itv 49,56,57,58,59,60,24)
icc = 32 * icc_maxstress
sig_tf_wp_max = 4.0e8

* Dump voltage upper limit (SCTF) (itv 51,52,56,57,58,59,60,24)
icc = 34 * icc_dumbvoltage
v_tf_coil_dump_quench_max_kv = 12.0           * Max voltage across tf coil during quench (kv)

** J_winding pack/J_protection upper limit (SCTF) (itv 53,56,57,58,59,60,24)
icc = 35 * icc_quench

* Dump time set by VV loads (itv 56, 113)
icc = 65 * icc_stressVV
max_vv_stress = 9.3e7   * The Allowable Peak Max Shear Stress In The Vacuum Vessel Due To Quench And Fast Discharge Of The TF Coils [Pa]


*---------------Iteration Variables----------------*

*ixc = 1
aspect   = 11.1         *Aspect ratio
*boundl(1) = 11.1
*boundu(1) = 16.6

ixc = 2                             *b_plasma_toroidal_on_axis
b_plasma_toroidal_on_axis = 5.5     *Toroidal field on axis (T)
boundl(2) = 4.0
boundu(2) = 10.0

ixc = 3                 *rmajor (m)
rmajor   = 22.0         *Plasma major radius (m)
boundl(3) = 10.0
boundu(3) = 30.0

ixc = 4                 *te (keV)
temp_plasma_electron_vol_avg_kev = 7.0  *Volume averaged electron temperature (keV)
boundl(4) = 3.
boundu(4) = 15.

ixc = 6                 *dene
nd_plasma_electrons_vol_avg = 2.0E20    *Electron density (/m3)
boundl(6) = 3.005E19
boundu(6) = 3.005E20

ixc = 10                *hfact
hfact = 1.0             *H-factor on energy confinement times
boundu(10) = 1.0

ixc = 25                * fp_plant_electric_net_required_mw
fp_plant_electric_net_required_mw = 1.0000        *f-value for net electric power
boundl(25) = 0.99
boundu(25) = 1.0

* ixc = 50                * itv_fiooic
fiooic = 0.8

ixc = 109 * f_nd_alpha_electron: thermal alpha density / electron density
boundl(109) = 0.0001
boundu(109) = 0.4

ixc = 59 * itv_fcutfsu Copper Fraction Of Cable Conductor (TF Coils)
f_a_tf_turn_cable_copper = 0.7
boundu(59) = 0.9
boundl(59) = 0.3

ixc = 56 * itv_tdmptf Fast Discharge Time For TF Coil In Event Of Quench (S) (`Iteration Variable 56`)
t_tf_superconductor_quench = 10.0
boundl(56) = 1
boundu(56) = 50.

* ixc = 176 * coil aspect ratio
f_st_coil_aspect = 1.0
* boundl(176) = 0.7
* boundu(176) = 1.3

*----------------Physics Variables-----------------*

alphan   = 0.35         *Density profile index
alphat   = 1.20         *Temperature profile index
i_plasma_ignited = 1    *Switch for ignition assumption (1: Ignited)
i_plasma_pedestal = 0   *Switch for pedestal profiles (0: Parabolic Profiles)
i_rad_loss = 1          *Switch for radiation loss term usage in power balance (1: Total power lost is scaling power plus core radiation only)
i_confinement_time = 38 *Switch for energy confinement time scaling law (38: ISS04)
f_sync_reflect = 0.6    *Synchrotron wall reflectivity factor
f_temp_plasma_ion_electron  = 0.95         *Ion temperature / electron temperature

falpha_energy_confinement = 1.
fradpwr = 1.

*--------------Stellarator Variables---------------*

istell   = 6            *Switch for stellarator option
isthtr   = 1            *Switch for stellarator auxiliary heating method (1: Electron cyclotron resonance heating)

*-----------------Build Variables------------------*

dr_blkt_inboard  = 0.41         *Inboard blanket thickness (m)
dr_blkt_outboard  = 0.63        *Outboard blanket thickness (m)
dr_cryostat    = 0.05           *Cryostat thickness (m)
dr_vv_inboard  = 0.60           *Inboard vacuum vessel thickness (tf coil / shield) (m)
dr_vv_outboard = 0.60           *Outboard vacuum vessel thickness (tf coil / shield) (m)
dz_vv_upper = 0.60              *Topside vacuum vessel thickness (tf coil / shield) (m)
dz_vv_lower = 0.60              *Underside vacuum vessel thickness (tf coil / shield) (m)
dr_shld_vv_gap_inboard  = 0.25  *Gap between inboard vacuum vessel and tf coil (m)
gapomin  = 0.25                 *Minimum gap between outboard vacuum vessel and TF coil (m)
dr_fw_plasma_gap_inboard = 0.3  *Gap between plasma and first wall; inboard side (m)
dr_fw_plasma_gap_outboard = 0.3 *Gap between plasma and first wall; outboard side (m)
dr_shld_inboard  = 0.3          *Inboard shield thickness (m)
dr_shld_outboard  = 0.3         *Outboard shield thickness (m)
dz_shld_upper  = 0.3            *Upper/lower shield thickness (m)
dz_xpoint_divertor     = 0.0    *Vertical gap between x-point and divertor (m)

*-------------Current Drive Variables--------------*

eta_ecrh_injector_wall_plug   = 0.5          *ECH wall plug to injector efficiency
p_hcd_primary_extra_heat_mw   = 0.0          *Heating power not used for current drive (MW)

*----------------Divertor Variables----------------*

anginc   = 0.03         *Angle of incidence of field line on plate (rad)
tdiv     = 5.0          *Temperature at divertor (eV)
xpertin  = 1.5          *Perpendicular heat transport coefficient (m2/s)
bmn      = 0.001        *Relative radial field perturbation
f_asym   = 1.1          *Divertor heat load peaking factor
f_rad    = 0.85         *Radiated power fraction in sol
f_w      = 0.5          *Island size fraction factor
flpitch  = 0.001        *Field line pitch (rad)
iotabar  = 1.0          *Rotational transform (reciprocal of tokamak q)
shear    = 0.5          *Magnetic shear, derivative of iotabar


*------------------FWBs Variables------------------*

den_steel   = 7800.0               *Density of steel (kg/m3)
f_p_blkt_multiplication = 1.35  *Energy multiplication in blanket and shield
eta_coolant_pump_electric = 1.0 *Electrical efficiency of primary coolant pumps
fblbe    = 0.3663               *Beryllium fraction of blanket by volume
fblli2o  = 0.1491               *Lithium oxide fraction of blanket by volume
fbllipb  = 0.00                 *Lithium lead fraction of blanket by volume
fblss    = 0.0985               *Stainless steel fraction of blanket by volume
fblvd    = 0.00                 *Vanadium fraction of blanket by volume
fhole    = 0.0                  *Area fraction taken up by other holes (not used)
fwclfr   = 0.35                 *First wall coolant fraction
f_a_blkt_cooling_channels   = 0.386    *Coolant void fraction in blanket (blktmodel=0)
vfshld   = 0.40                 *Coolant void fraction in shield

declblkt = 0.1        *Neutron Power Deposition Decay Length Of Blanket Structural Material [M] (Stellarators Only)
declfw = 0.1          *Neutron Power Deposition Decay Length Of First Wall Structural Material [M] (Stellarators Only)
declshld = 0.056        *Neutron Power Deposition Decay Length Of Shield Structural Material [M] (Stellarators Only)

*-------------Heat Transport Variables-------------*

i_p_coolant_pumping = 1   *Switch for pumping power (0: User sets pump power directly, 1:calculate pump power)
f_p_blkt_coolant_pump_total_heat = 0.033       *fraction of total blanket thermal power required to drive the blanket coolant pumps      
f_p_fw_coolant_pump_total_heat = 0.033         *fraction of total first wall thermal power required to drive the FW coolant pumps
f_p_div_coolant_pump_total_heat = 0.107        *fraction of total divertor thermal power required to drive the divertor coolant pumps
f_p_shld_coolant_pump_total_heat = 0.0         *Fraction Of Total Shield Thermal Power Required To Drive The Shield Coolant
i_thermal_electric_conversion = 2 *Switch for power conversion cycle (2: user input thermal-electric efficiency)
eta_turbine    = 0.375  *Thermal to electric conversion efficiency; if seconday_cycle=2

*------------Impurity Radiation Module-------------*

radius_plasma_core_norm = 0.6       * Normalised radius defining the 'core' region
f_p_plasma_core_rad_reduction = 1.0 * Fraction of radiation from 'core' region that is subtracted from the loss power
f_nd_impurity_electrons(1)  = 1.0          *Hydrogen (fraction calculated by code)
f_nd_impurity_electrons(2)  = 0.1          *Helium (fraction calculated by code)
f_nd_impurity_electrons(3)  = 0.0          *Beryllium
f_nd_impurity_electrons(4)  = 0.0          *Carbon
f_nd_impurity_electrons(5)  = 0.0          *Nitrogen
f_nd_impurity_electrons(6)  = 0.0          *Oxygen
f_nd_impurity_electrons(7)  = 0.0          *Neon
f_nd_impurity_electrons(8)  = 0.0          *Silicon
f_nd_impurity_electrons(9)  = 0.0          *Argon
f_nd_impurity_electrons(10) = 0.0          *Iron
f_nd_impurity_electrons(11) = 0.0          *Nickel
f_nd_impurity_electrons(12) = 0.0          *Krypton
f_nd_impurity_electrons(13) = 0.0          *Xenon
f_nd_impurity_electrons(14) = 1.0E-5       *Tungsten

*---------------------Numerics---------------------*

ioptimz  = 1            *Code operation switch (1: Optimisation, VMCON only)
maxcal   = 50          *Maximum number of VMCON iterations
minmax   = 6            *Switch for figure-of-merit (7: Min Capital Cost)
epsfcn   = 0.001
runtitle = SQuID

*-----------------Tfcoil Variables-----------------*

i_tf_sc_mat = 8         * Switch for superconductor material in tf coils (1: ITER Nb3Sn)
tftmp     = 4.5         * Peak helium coolant temperature in TF coils and PF coils (K)
tmargmin = 1.5          * Temperature margin for superconductor current denisty calculation (K)
temp_tf_cryo = 4.5      * Coil temperature for cryogenic plant power calculation (K)
dx_tf_turn_general = 0.056                * Dimension conductor area including steel and insulation.
dx_tf_turn_insulation = 0.002             * Conduit insulation thickness (m)
dx_tf_turn_steel = 0.0012                 * TF coil conduit case thickness (m)
f_a_tf_turn_cable_space_extra_void = 0.3  * Coolant fraction of TF coil leg (i_tf_sup=0)
dr_tf_nose_case  = 0.06                   * Case thickness
dx_tf_wp_insulation = 0.01                * Insulation on top of winding pack
t_tf_quench_detection = 0.5               * Quench detection+activation time (or dump delay) (s)

*------------------Cost Variables------------------*
cost_model = 0          *0: 1990 cost module, the 2015 does not work yet for stellarators
abktflnc = 15.0         *Allowable first wall/blanket neutron (MW-yr/m2)
adivflnc = 25.0         *Allowable divertor heat fluence (MW-yr/m2)
cfactr   = 0.75         *Total plant capacity fraction
dintrt   = 0.00         *Diff between borrowing and saving interest rates
fcap0    = 1.15         *Average cost of money for construction of plant
fcap0cp  = 1.06         *Average cost of money for replaceable components
fcontng  = 0.15         *Project contingency factor
fcr0     = 0.065        *Fixed charge rate during construction
fkind    = 1.0          *Multiplier for nth of a kind costs
iavail   = 0            *Switch for plant availability model (0: Use input value for cfactr)
ifueltyp = 0            *Switch (0: treat blanket divertor first wall and fraction fcdfuel of CD equipment as capital cost)
ireactor = 1            *Switch for net electric power calculations (1: Calculate MW electric and c-o-e)
lsa      = 2            *Level of safety assurance switch (2: In-between)
discount_rate = 0.06    *Effective cost of money in constant dollars
tlife    = 40.0         *Plant life (years)
ucblvd   = 280.0        *Unit cost for blanket vanadium ($/kg)
ucdiv    = 5.0E5        *Cost of divertor blade ($)
ucme     = 3.0E8        *Unit cost of maintenance equipment ($)